javascript:(()=>{"use strict";const e="NgSlackLinkifier",t="0.1.4",n="nsl-github-commit",s="nsl-github-issue",o="nsl-jira",i="nsl-processed",r="nsl-post-processed",a="%";class l{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class c{constructor(e){this._cacheMaxAge=6e4,this._cache=new Map,this._headers=e&&{Authorization:`token ${e}`}}cleanUp(){this._cache.clear()}getCommitInfo(e,t,n){const s=`https://api.github.com/repos/${e}/${t}/commits/${n}`;return this._getJson(s).then(e=>({sha:e.sha,message:e.commit.message,author:this._extractUserInfo(e.author),committer:this._extractUserInfo(e.committer),authorDate:new Date(e.commit.author.date),committerDate:new Date(e.commit.committer.date),stats:e.stats,files:e.files.map(e=>this._extractFileInfo(e))})).catch(s=>{throw new Error(`Error getting GitHub info for ${e}/${t}@${n}:\n${s.message||s}`)})}getIssueInfo(e,t,n){const s=`https://api.github.com/repos/${e}/${t}/issues/${n}`;return this._getJson(s).then(e=>({number:e.number,title:e.title,description:e.body.trim(),author:this._extractUserInfo(e.user),state:e.state,labels:e.labels.map(e=>e.name),isPr:e.html_url.endsWith(`/pull/${e.number}`)})).catch(s=>{throw new Error(`Error getting GitHub info for ${e}/${t}#${n}:\n${s.message||s}`)})}_extractFileInfo(e){return{filename:e.filename,patch:e.patch,status:e.status,stats:{total:e.changes,additions:e.additions,deletions:e.deletions}}}_extractUserInfo(e){return{avatar:e.avatar_url,username:e.login,url:e.html_url}}async _getErrorForResponse(e){const t=e.headers;let n=await e.json();if(n.message||(n={message:JSON.stringify(n)}),403===e.status&&"0"==t.get("X-RateLimit-Remaining")){const e=t.get("X-RateLimit-Limit"),s=new Date(1e3*t.get("X-RateLimit-Reset"));n.message=`0/${e} API requests remaining until ${s.toLocaleString()}.\n${n.message}`}return new Error(`${e.status} (${e.statusText}) - ${n.message}`)}_getFromCache(e){if(!this._cache.has(e))return;const{date:t,response:n}=this._cache.get(e);if(!(Date.now()-t>this._cacheMaxAge))return n;this._cache.delete(e)}_getJson(e){let t=this._getFromCache(e);return t||(t=fetch(e,{headers:this._headers}).then(async e=>e.ok?e.json():Promise.reject(await this._getErrorForResponse(e))).catch(n=>{throw this._getFromCache(e)===t&&this._cache.delete(e),n}),this._cache.set(e,{date:Date.now(),response:t})),t}}class h extends Error{}class p{get length(){return this._keys().length}constructor(){this._resetItems()}clear(){this._resetItems()}getItem(e){return this._has(e)?this._items[e]:null}key(e){const t=this._keys();return e<t.length?t[e]:null}removeItem(e){delete this._items[e]}setItem(e,t){this._items[e]=`${t}`}_has(e){return Object.prototype.hasOwnProperty.call(this._items,e)}_keys(){return Object.keys(this._items)}_resetItems(){this._items=Object.create(null)}}class d{constructor(e=(()=>void 0)){this._postProcessNode=e,this._observer=new MutationObserver(e=>e.forEach(e=>e.addedNodes&&setTimeout(()=>this.processAll(e.addedNodes),500)))}cleanUp(){this._observer.disconnect()}observe(e){this._observer.observe(e,{childList:!0,subtree:!0})}processAll(e,t=!1){const n=".c-message__body, .c-message_attachment__body, .c-message_kit__text",s=new Set;e.forEach(e=>{if(s.has(e.parentNode))return;(e.closest?e.closest(n):e.parentNode&&e.parentNode.closest(n))?this._processNode(e.parentNode,t):e.querySelectorAll&&e.querySelectorAll(n).forEach(e=>this._processNode(e,t))})}_acceptNodeInTextNodeWalker(e){return!e.parentNode||"A"===e.parentNode.nodeName||e.parentNode.parentNode&&"A"===e.parentNode.parentNode.nodeName?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}_processNode(e,t){const n=new Set([...this._processNodeMdLinks(e),...this._processNodeGithubCommits(e),...this._processNodeGithubIssues(e),...this._processNodeJira(e)]);n.forEach(e=>e.classList.add(i)),(t||n.size)&&this._postProcessNode(e)}_processNodeGithubCommits(e){const t=new Set,s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>this._acceptNodeInTextNodeWalker(e)},!1);let o;for(;o=s.nextNode();){const e=/(?:([\w-]+)\/)?([\w-]+)@([A-Fa-f\d]{7,})\b/.exec(o.textContent);if(e){const[,n="angular",s="angular",i]=e,r=`https://github.com/${n}/${s}/commit/${i}`,a=Object.assign(document.createElement("a"),{href:r,target:"_blank",textContent:r}),l=document.createTextNode(o.textContent.slice(e.index+e[0].length));o.textContent=o.textContent.slice(0,e.index),o.after(a),a.after(l),t.add(a)}}return e.querySelectorAll(`a:not(.${i})`).forEach(e=>{const s=/^https:\/\/github\.com\/([\w-]+)\/([\w-]+)\/commit\/([A-Fa-f\d]{7,})$/.exec(e.href)||new RegExp(`^https://slack-redir\\.net/link\\?url=https${a}3A${a}2F${a}2Fgithub\\.com${a}2F([\\w-]+)${a}2F([\\w-]+)${a}2Fcommit${a}2F([A-Fa-f\\d]{7,})$`).exec(e.href);if(s){const[,o,i,r]=s;e.classList.add(n),e.dataset.nslOwner=o,e.dataset.nslRepo=i,e.dataset.nslCommit=r,t.add(e)}const o=/^https:\/\/github\.com\/([\w-]+)\/([\w-]+)\/commit\/([A-Fa-f\d]{7,})$/.exec(e.innerHTML);if(o){const[,n,s,i]=o,r=`${"angular"===n?"":`${n}/`}${s}`;e.innerHTML=`<b>${r}@${i.slice(0,7)}</b>`,t.add(e)}}),t}_processNodeGithubIssues(e){const t=new Set,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>this._acceptNodeInTextNodeWalker(e)},!1);let o;for(;o=n.nextNode();){const e=/(?:(?:([\w-]+)\/)?([\w-]+))?#(\d+)\b/.exec(o.textContent);if(e){const[,n="angular",s="angular",i]=e,r=`https://github.com/${n}/${s}/issues/${i}`,a=Object.assign(document.createElement("a"),{href:r,target:"_blank",textContent:r}),l=document.createTextNode(o.textContent.slice(e.index+e[0].length));o.textContent=o.textContent.slice(0,e.index),o.after(a),a.after(l),t.add(a)}}return e.querySelectorAll(`a:not(.${i})`).forEach(e=>{const n=/^https:\/\/github\.com\/([\w-]+)\/([\w-]+)\/(?:issues|pull)\/(\d+)$/.exec(e.href)||new RegExp(`^https://slack-redir\\.net/link\\?url=https${a}3A${a}2F${a}2Fgithub\\.com${a}2F([\\w-]+)${a}2F([\\w-]+)${a}2F(?:issues|pull)${a}2F(\\d+)$`).exec(e.href);if(n){const[,o,i,r]=n;e.classList.add(s),e.dataset.nslOwner=o,e.dataset.nslRepo=i,e.dataset.nslNumber=r,t.add(e)}const o=/^https:\/\/github\.com\/([\w-]+)\/([\w-]+)\/(?:issues|pull)\/(\d+)$/.exec(e.innerHTML);if(o){const[,n,s,i]=o,r="angular"===n,a="angular"===s,l=`${r?"":`${n}/`}${r&&a?"":s}`;e.innerHTML=`<b>${l}#${i}</b>`,t.add(e)}}),t}_processNodeJira(e){const t=new Set,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>this._acceptNodeInTextNodeWalker(e)},!1);let s;for(;s=n.nextNode();){const e=/(?<!https:\/\/angular-team\.atlassian\.net\/browse\/)\b([A-Z]+-\d+)\b/.exec(s.textContent);if(e){const n=`https://angular-team.atlassian.net/browse/${e[1]}`,o=Object.assign(document.createElement("a"),{href:n,target:"_blank",textContent:n}),i=document.createTextNode(s.textContent.slice(e.index+e[0].length));s.textContent=s.textContent.slice(0,e.index),s.after(o),o.after(i),t.add(o)}}return e.querySelectorAll(`a:not(.${i})`).forEach(e=>{const n=/^https:\/\/angular-team\.atlassian\.net\/browse\/([A-Z]+-\d+)$/.exec(e.href)||new RegExp(`^https://slack-redir\\.net/link\\?url=https${a}3A${a}2F${a}2Fangular-team\\.atlassian\\.net${a}2Fbrowse${a}2F([A-Z]+-\\d+)$`).exec(e.href);n&&(e.classList.add(o),e.dataset.nslNumber=n[1],t.add(e));const s=/^https:\/\/angular-team\.atlassian\.net\/browse\/([A-Z]+-\d+)$/.exec(e.innerHTML);s&&(e.innerHTML=`<b>${s[1]}</b>`,t.add(e))}),t}_processNodeMdLinks(e){const t=new Set;return e.querySelectorAll(`a:not(.${i})`).forEach(e=>{const n=e.previousSibling,s=n&&n.nodeType===Node.TEXT_NODE&&/\[([^\]]+)]\(/.exec(n.textContent),o=s&&e.nextSibling,i=o&&o.nodeType===Node.TEXT_NODE&&/\)/.exec(o.textContent);i&&(n.textContent=n.textContent.slice(0,-s[0].length),o.textContent=o.textContent.slice(i[0].length),e.innerHTML=`<b>${s[1]}</b>`,t.add(e))}),t}}class u{constructor(e){this._prefix=`[${e}]`}cleanUp(){}log(...e){console.log(this._prefix,...e)}warn(...e){console.warn(this._prefix,...e)}error(...e){console.error(this._prefix,...e)}}class g{constructor(){this._crypto=window.crypto.subtle,this._version="1",this._decoder=new TextDecoder,this._encoder=new TextEncoder,this._algorithm={name:"AES-CBC",iv:this._encoder.encode("SupposedlyRandom")},this._superSecretKey=null,this._ready=this._init()}cleanUp(){}async decrypt(e){await this._ready;const[t,n,...s]=e.split(":"),o=n&&n.split(",").filter(Boolean).map(Number);if(s.length||!o||!o.length||o.some(Number.isNaN))throw new Error(`Unable to decrypt \`${e}\`: Invalid or unknown format.`);if(t!==this._version)throw new Error(`Unable to decrypt \`${e}\`: Version mismatch (expected: ${this._version}).`);const i=await this._crypto.decrypt(this._algorithm,this._superSecretKey,Uint16Array.from(o));return this._decoder.decode(i)}async encrypt(e){await this._ready;const t=await this._crypto.encrypt(this._algorithm,this._superSecretKey,this._encoder.encode(e));return`${this._version}:${new Uint16Array(t).join(",")}`}async _init(){this._superSecretKey=await this._crypto.importKey("raw",this._encoder.encode("$NgSl@ckL1nk1fy$"),this._algorithm,!1,["decrypt","encrypt"])}}class m{constructor(e,t){this._prefix=`${e}:`,this._store=t}clear(){this.keys().forEach(e=>this.delete(e))}delete(e){this._store.removeItem(this._keyFor(e))}get(e){const t=this._store.getItem(this._keyFor(e));return null===t?void 0:JSON.parse(t)}has(e){return null!==this._store.getItem(this._keyFor(e))}keys(){return Array.from(new Array(this._store.length),(e,t)=>this._store.key(t)).filter(e=>e.startsWith(this._prefix))}set(e,t){void 0!==t&&this._store.setItem(this._keyFor(e),JSON.stringify(t))}_keyFor(e){return`${this._prefix}${e}`}}class _{constructor(e){this.local=new m(e,window.localStorage),this.session=new m(e,window.sessionStorage),this.inMemory=new m(e,new p)}cleanUp(){this.inMemory.clear()}}class b{constructor(){this._openDialogs=[],this._popup=null,this._hidePopupTimeout=null,this._showPopupTimeout=null,this._snackbarContainer=this._createSnackbarContainer()}cleanUp(){this._openDialogs.reverse().forEach(e=>this._fadeOut(e)),this._openDialogs=[],this.hidePopup(),this._snackbarContainer.remove()}hidePopup(){this._cancelHidePopup(),this._popup&&(this._fadeOut(this._popup),this._popup=null)}scheduleHidePopup(e){return!this._hidePopupTimeout&&(this._cancelShowPopup(),!!this._popup&&(this._hidePopupTimeout=setTimeout(()=>this.hidePopup(),e),!0))}scheduleShowPopup(e,t,n){return this._cancelHidePopup(),this._cancelShowPopup(),this._showPopupTimeout=setTimeout(()=>this.showPopup(e,t),n),!0}showDialog(n,s,o){const i=new l,r=e=>{this._fadeOut(a),i.resolve(e)},a=Object.assign(document.createElement("div"),{className:"nsl-dialog-backdrop",innerHTML:`\n          <div class="nsl-dialog">\n            <header class="nsl-dialog-header">${e} v${t}</header>\n            <section class="nsl-dialog-content">${n}</section>\n            <footer class="nsl-dialog-actions">\n              <button class="nsl-dialog-btn-ok">${s}</button>\n              <button class="nsl-dialog-btn-cancel">${o}</button>\n            </footer>\n          </div>\n        `,style:"\n          align-items: center;\n          background-color: rgba(0, 0, 0, 0.5);\n          bottom: 0;\n          display: flex;\n          justify-content: center;\n          padding: 15px;\n          position: fixed;\n          left: 0;\n          right: 0;\n          top: 0;\n          z-index: 9999;\n        "});return Object.assign(a.querySelector(".nsl-dialog"),{style:`\n          background-color: white;\n          border: 1px solid lightgray;\n          border-radius: 6px;\n          box-shadow: 0 0 0 1px rgba(0, 0, 0, .08), 0 4px 12px 0 rgba(0, 0, 0, .12);\n          box-sizing: border-box;\n          display: flex;\n          flex-direction: column;\n          max-height: ${Math.min(window.innerHeight-30,700)}px;\n          max-width: ${Math.min(window.innerWidth-30,900)}px;\n          min-height: ${Math.min(window.innerHeight-30,500)}px;\n          min-width: ${Math.min(window.innerWidth-30,750)}px;\n          overflow: auto;\n          padding: 15px;\n          pointer-events: all;\n        `}),Object.assign(a.querySelector(".nsl-dialog-header"),{style:"\n          color: gray;\n          font-size: 0.75em;\n          text-align: right;\n        "}),Object.assign(a.querySelector(".nsl-dialog-content"),{style:"\n          user-select: text;\n        "}),Object.assign(a.querySelector(".nsl-dialog-actions"),{style:"\n          display: flex;\n          justify-content: flex-end;\n          user-select: text;\n        "}),Object.assign(a.querySelector(".nsl-dialog-btn-ok"),{onclick:()=>r(!0),onmouseenter:e=>e.target.style.borderColor="orange",onmouseleave:e=>e.target.style.borderColor="white",style:"\n          background-color: green;\n          border: 2px solid white;\n          border-radius: 6px;\n          color: white;\n          margin-right: 15px;\n          padding: 10px 15px;\n        "}),Object.assign(a.querySelector(".nsl-dialog-btn-cancel"),{onclick:()=>r(!1),onmouseenter:e=>e.target.style.borderColor="orange",onmouseleave:e=>e.target.style.borderColor="white",style:"\n          background-color: gray;\n          border: 2px solid white;\n          border-radius: 6px;\n          color: white;\n          padding: 10px 15px;\n        "}),this._openDialogs.push(a),document.body.appendChild(a),this._fadeIn(a),i.promise}showPopup(e,t){this._cancelShowPopup(),this.hidePopup();const n=this._calculatePopupPositioning(t);this._popup=Object.assign(document.createElement("div"),{className:"nsl-popup",innerHTML:e,onmouseenter:()=>this._cancelHidePopup(),onmouseleave:()=>this.hidePopup(),style:`\n          background-color: white;\n          border: 1px solid gray;\n          border-radius: 6px;\n          bottom: ${n.bottom};\n          box-shadow: 0 0 0 1px rgba(0, 0, 0, .08), 0 4px 12px 0 rgba(0, 0, 0, .12);\n          left: ${n.left};\n          max-height: ${n.maxHeight};\n          overflow: auto;\n          padding: 10px;\n          position: fixed;\n          right: ${n.right};\n          top: ${n.top};\n          user-select: text;\n          z-index: 9999;\n        `}),document.body.appendChild(this._popup),this._fadeIn(this._popup)}showSnackbar(e,t=2e3){const n=Object.assign(document.createElement("div"),{className:"nsl-snackbar",innerHTML:`\n          <section class="nsl-snackbar-content">${e}</section>\n          <button class="nsl-snackbar-btn-close">&#x2715;</button>\n        `,style:"\n          background-color: white;\n          border: 1px solid lightgray;\n          border-radius: 6px;\n          box-shadow: 0 0 0 1px rgba(0, 0, 0, .08), 0 4px 12px 0 rgba(0, 0, 0, .12);\n          box-sizing: border-box;\n          display: flex;\n          margin-top: 5px;\n          max-height: 500px;\n          max-width: 750px;\n          min-width: 400px;\n          pointer-events: all;\n        "});Object.assign(n.querySelector(".nsl-snackbar-content"),{style:"\n          overflow: auto;\n          padding: 10px 5px 10px 10px;\n          user-select: text;\n        "}),Object.assign(n.querySelector(".nsl-snackbar-btn-close"),{onclick:()=>this._fadeOut(n),onmouseenter:e=>e.target.style.color="red",onmouseleave:e=>e.target.style.color="lightgray",style:"\n          align-self: flex-start;\n          background-color: transparent;\n          border: none;\n          color: lightgray;\n          cursor: pointer;\n          margin-top: -5px;\n          padding: 5px;\n        "}),this._snackbarContainer.appendChild(n);const s=this._fadeIn(n);return t<0?s:s.then(()=>new Promise(e=>setTimeout(e,t))).then(()=>this._fadeOut(n))}_animateProp(e,t,n,s,o=200){const i=e.style;return this._withRafInterval([()=>i.transition="",()=>i[t]=n,()=>i.transition=`${t} ${o}ms linear`,()=>i[t]=s]).then(()=>new Promise(e=>setTimeout(e,o)))}_calculatePopupPositioning(e){const t=e.target.getBoundingClientRect(),n=t.top,s=window.innerHeight-t.bottom,o=s<=500&&(n>500||n>s);return{maxHeight:`${Math.min(750,(o?n:s)-10)}px`,top:o?"auto":`${t.bottom}px`,bottom:o?`${window.innerHeight-t.top}px`:"auto",...(()=>{const e=(t.left+t.right)/2;let n=Math.max(10,e-450),s=Math.min(window.innerWidth-10,n+900);return s-n<900&&(n=Math.max(10,s-900)),{left:`${n}px`,right:`${window.innerWidth-s}px`}})()}}_cancelHidePopup(){this._hidePopupTimeout&&(clearTimeout(this._hidePopupTimeout),this._hidePopupTimeout=null)}_cancelShowPopup(){this._showPopupTimeout&&(clearTimeout(this._showPopupTimeout),this._showPopupTimeout=null)}_createSnackbarContainer(){const e=Object.assign(document.createElement("div"),{className:"nsl-snackbar-container",style:"\n          bottom: 10px;\n          display: flex;\n          flex-direction: column-reverse;\n          pointer-events: none;\n          position: fixed;\n          right: 10px;\n          z-index: 9999;\n        "});return document.body.appendChild(e),e}_fadeIn(e,t){return this._animateProp(e,"opacity",.1,1,t)}_fadeOut(e,t){return this._animateProp(e,"opacity",1,.1,t).then(()=>e.remove())}_withRafInterval(e){return new Promise((t,n)=>{if(!e.length)return t();e.shift()(),window.requestAnimationFrame(()=>this._withRafInterval(e).then(t,n))})}}(new class{constructor(){this._KEYS={githubToken:1},this._logUtils=new u(`${e} v${t}`),this._secretUtils=new g,this._storageUtils=new _(e),this._linkifier=new d(e=>this._addListeners(e)),this._uiUtils=new b,this._ghUtils=null,this._cleanUpFns=[()=>this._linkifier.cleanUp(),()=>this._logUtils.cleanUp(),()=>this._secretUtils.cleanUp(),()=>this._storageUtils.cleanUp(),()=>this._uiUtils.cleanUp()],this._destroyedDeferred=new l}cleanUp(){this._logUtils.log("Uninstalling..."),this._destroyedDeferred.reject(new h("Cleaning up.")),this._cleanUpFns.forEach(e=>e()),this._cleanUpFns=[],this._logUtils.log("Uninstalled.")}async main(){try{window.__ngSlackLinkifyCleanUp&&window.__ngSlackLinkifyCleanUp(),this._logUtils.log("Installing..."),window.__ngSlackLinkifyCleanUp=(()=>{this.cleanUp(),window.__ngSlackLinkifyCleanUp=null}),await Promise.race([this._init(),this._destroyedDeferred.promise]);const e=document.querySelector("#client_body");this._linkifier.processAll([e],!0),this._linkifier.observe(e),this._logUtils.log("Installed.")}catch(e){this._onError(e)}}_addListeners(e){const t=new Set;e.querySelectorAll(`.${n}:not(.${r})`).forEach(e=>{t.add(e),this._addListenersForLink(e,e=>this._getPopupContentForGithubCommit(e))}),e.querySelectorAll(`.${s}:not(.${r})`).forEach(e=>{t.add(e),this._addListenersForLink(e,e=>this._getPopupContentForGithubIssue(e))}),e.querySelectorAll(`.${o}:not(.${r})`).forEach(e=>{t.add(e),this._addListenersForLink(e,e=>this._getPopupContentForJira(e))}),t.forEach(e=>{e.classList.add(r),this._cleanUpFns.push(()=>e.classList.remove(r))})}_addListenersForLink(e,t){const n=e.style,s=e.dataset;let o=0;const i=async e=>{try{const i=o;if(await new Promise(e=>setTimeout(e,500)),i!==o)return;n.cursor="progress";const r=await t(s);if(i!==o)return;n.cursor="help",this._uiUtils.showPopup(r,e)}catch(e){this._onError(e)}},r=()=>{++o,n.cursor="help",this._uiUtils.scheduleHidePopup(500)};n.cursor="help",e.addEventListener("mouseenter",i),e.addEventListener("mouseleave",r),this._cleanUpFns.push(()=>e.removeEventListener("mouseenter",i),()=>e.removeEventListener("mouseleave",r))}async _getPopupContentForGithubCommit(e){const t={added:"green",modified:"darkorchid",removed:"red",renamed:"blue"},n=e.nslOwner,s=e.nslRepo,o=e.nslCommit,i=await this._ghUtils.getCommitInfo(n,s,o),r=i.message.split("\n",1).pop(),a=i.message.slice(r.length).trim();return`\n        <p style="display: flex; font-size: 0.9em; justify-content: space-between;">\n          <span>\n            <img src="${i.author.avatar}" width="25" height="25" style="border-radius: 6px;" />\n            <a href="${i.author.url}" target="_blank">@${i.author.username}</a>\n          </span>\n          <small style="color: gray; text-align: right;">\n            Committed on: ${i.committerDate.toLocaleString()}\n          </small>\n        </p>\n        <p style="align-items: flex-start; display: flex; font-size: 1.25em;">\n          <b>${r}</b>\n          <span style="color: gray; margin-left: 5px;">@${i.sha.slice(0,7)}</span>\n        </p>\n        ${a&&`<br /><pre>${a}</pre>`}\n        <hr />\n        <div>\n          <p style="display: flex;">\n            <b style="flex: auto;">Files (${i.files.length}):</b>\n            <small style="color: lightgray;">Click on a file to see diff.</small>\n          </p>\n          <div style="overflow: auto;">\n            <div style="display: flex; flex-direction: column; width: fit-content;">\n              ${i.files.map(e=>{const n=e.patch.replace(/"/g,"&quot;").replace(/\n/g,"\n"),s=e.patch.split("\n").map(e=>`<span style="${e.startsWith("+")?"background-color: rgba(0, 255, 0, 0.11);":e.startsWith("-")?"background-color: rgba(255, 0, 0, 0.11);":e.startsWith("@@")?"color: rgba(0, 0, 0, 0.33);":"color: rgba(0, 0, 0, 0.66);"}">${e}</span>`).join("\n");return`\n          <details>\n            <summary\n                style="align-items: baseline; cursor: pointer; display: flex; margin: 0 15px 10px; outline: none;"\n                title="${n}">\n              <small style="\n                    background-color: ${t[e.status]};\n                    border-radius: 6px;\n                    color: white;\n                    font-size: 0.75em;\n                    line-height: 1em;\n                    margin-right: 5px;\n                    min-width: 55px;\n                    opacity: 0.5;\n                    padding: 2px 4px;\n                    text-align: center;\n                  ">\n                ${e.status}\n              </small>\n              <span style="flex: auto; white-space: nowrap;">\n                ${e.filename}\n              </span>\n              <small style="text-align: right; white-space: nowrap;">\n                <span style="color: ${t.added}; display: inline-block; min-width: 33px;">\n                  +${e.stats.additions}\n                </span>\n                <span style="color: ${t.removed}; display: inline-block; min-width: 33px;">\n                  -${e.stats.deletions}\n                </span>\n              </small>\n            </summary>\n            <pre style="font-size: 0.9em; line-height: calc(0.9em + 5px);">${s}</pre>\n          </details>\n        `}).join("")}\n            </div>\n          </div>\n        </div>\n      `}async _getPopupContentForGithubIssue(e){const t=e.nslOwner,n=e.nslRepo,s=e.nslNumber,o=await this._ghUtils.getIssueInfo(t,n,s),i=o.description.replace(/^<!--[^]*?-->\s*/,"");return`\n        <p style="display: flex; font-size: 0.9em; justify-content: space-between;">\n          <span>\n            <img src="${o.author.avatar}" width="25" height="25" style="border-radius: 6px;" />\n            <a href="${o.author.url}" target="_blank">@${o.author.username}</a>\n          </span>\n          <span style="text-align: right;">\n            ${o.labels.sort().map(e=>`\n              <small style="\n                    border: 1px solid;\n                    border-radius: 6px;\n                    line-height: 2.5em;\n                    margin: 0 3px;\n                    padding: 2px 4px;\n                    text-align: center;\n                    white-space: nowrap;\n                  ">${e}</small>\n            `).join("\n")}\n          </span>\n        </p>\n        <p style="align-items: flex-start; display: flex; font-size: 1.25em;">\n          <span style="\n                background-color: ${{closed:"red",draft:"gray",merged:"darkorchid",open:"green"}[o.state]};\n                border-radius: 6px;\n                color: white;\n                font-size: 0.75em;\n                margin-right: 5px;\n                padding: 2px 4px;\n                text-align: center;\n              ">\n            ${o.state.toUpperCase()}\n          </span>\n          <b style="flex: auto;">${o.title}</b>\n          <span style="color: gray; margin-left: 5px; white-space: nowrap;">\n            <span style="color: lightgray;">${o.isPr?"PR":"Issue"}:</span>\n            #${o.number}\n          </span>\n        </p>\n        <br />\n        <pre>${i||'<i style="color: gray;">No description.</i>'}</pre>\n      `}async _getPopupContentForJira(e){return`\n        <div style="color: orange; font-size: 1.25em; text-align: center;">\n          [${e.nslNumber}] Fetching info for Jira issues is not yet supported :(\n        </div>\n      `}async _getToken(e,t,n){const s=this._storageUtils.inMemory.get(e)||this._storageUtils.session.get(e)||this._storageUtils.local.get(e)||await this._promptForToken(e,t,n);if(s)try{return await this._secretUtils.decrypt(s)}catch(t){throw this._storageUtils.inMemory.delete(e),this._storageUtils.session.delete(e),this._storageUtils.local.delete(e),t}}async _init(){const e=await this._getToken(this._KEYS.githubToken,"GitHub access token","\n        <p>\n          It can be used to make authenticated requests to GitHub's API, when retrieving issue/PR info. Authenticated\n          requests have a much higher limit for requests per hour (at the time of writing 5000 vs 60 for anonymous\n          requests).\n        </p>\n        <p>Providing a GitHub access token is <b>optional</b>.</p>\n      ");this._ghUtils=new c(e)}_promptForToken(t,n,s,o=!1){const i=this._storageUtils.local.get("prompts")||{},r=i[t]||(i[t]={});if(!o&&r.noCheckOnStartup)return;const a=`${e}-ctx-${Date.now()}`,l=window[a]={token:"",storage:"local",noCheckOnStartup:!!r.noCheckOnStartup},c=`\n        <h2>No ${n} detected</h2>\n        <hr />\n        <p>It seems like you have not provided a ${n}.</p>\n        <p>${s}</p>\n        <hr />\n        <p>Would you like to provide one now?</p>\n        <p>\n          <form>\n            <label style="display: block;">\n              Token:\n              <input\n                  type="password"\n                  placeholder="(required)"\n                  value="${l.token}"\n                  oninput="javascript:window['${a}'].token = event.target.value;"\n                  />\n            </label>\n            <label style="display: block;">\n              Store:\n              <select value="${l.store}" onchange="javascript:window['${a}'].storage = event.target.value;">\n                <option value="local">Permanently (for this browser)</option>\n                <option value="session">Only for current session</option>\n              </select>\n            </label>\n            <label style="display: block; text-align: right;">\n              Do not ask again:\n              <input\n                  type="checkbox"\n                  style="margin-left: 15px; transform: translateX(-50%) scale(2);"\n                  ${l.noCheckOnStartup?"checked":""}\n                  onclick="javascript:window['${a}'].noCheckOnStartup = event.target.checked"\n                  />\n            </label>\n          </form>\n        </p>\n      `;return this._uiUtils.showDialog(c,"Store token","Not now").finally(()=>delete window[a]).then(async e=>{if(r.noCheckOnStartup=l.noCheckOnStartup,this._storageUtils.local.set("prompts",i),!e)return;const s=this._storageUtils[l.storage];if(!l.token||!s){const e=`Unable to store the ${n}: Invalid data provided (token or storage target).\n`+"(Proceeding without a token.)";return this._logUtils.warn(e),void this._uiUtils.showSnackbar(`<div style="color: orange;">${e.replace(/\n/g,"<br />")}</div>`,5e3)}const o=await this._secretUtils.encrypt(l.token);return s.set(t,o),this._uiUtils.showSnackbar(`<b style="color: green;">Successfully stored ${n}.</b>`,2e3),o})}_onError(e){e instanceof h||(this._logUtils.error(e),this._uiUtils.showSnackbar('<pre style="background-color: white; border: none; color: red;">'+`<b>${e.message||e}</b><br />`+"<small>(See the console for more details.)</small></pre>",1e4))}}).main()})();